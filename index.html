<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title></title>
  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }
    #stage { position:fixed; inset:0; display:grid; place-items:center; background:#000; }
    #stage > img, #stage > video { max-width:100%; max-height:100%; object-fit:contain; background:#000; }
    #stage > embed, #stage > iframe { width:100%; height:100%; border:0; background:#000; }
  </style>
</head>
<body>
  <div id="stage"></div>
  <script>
    const INTERVAL_MS = 15000;
    const SUPPORTED = ['.jpg','.jpeg','.png','.gif','.webp','.svg','.pdf'];
    const IGNORE = ['index.html','readme.md','readme.txt'];

    const stage = document.getElementById('stage');

    function ext(name) { const i = name.lastIndexOf('.'); return i>=0 ? name.slice(i).toLowerCase() : ''; }
    function isSupported(name) { const e = ext(name); return SUPPORTED.includes(e) && !IGNORE.includes(name.toLowerCase()); }
    function withCB(url) { return url + (url.includes('?') ? '&' : '?') + '_=' + Date.now(); }

    function guessOwnerRepo() {
      const host = location.hostname;        // z. B. fc09jugendfussball.github.io
      const owner = host.split('.')[0];
      const parts = location.pathname.split('/').filter(Boolean);
      const repo = parts.length ? parts[0] : '';
      return { owner, repo };
    }

    async function fetchContents(owner, repo) {
      const branches = ['main','gh-pages'];
      for (const ref of branches) {
        try {
          const api = `https://api.github.com/repos/${owner}/${repo}/contents?ref=${ref}`;
          const res = await fetch(api);
          if (!res.ok) continue;
          const data = await res.json();
          if (Array.isArray(data)) return data;
        } catch(e) {}
      }
      return [];
    }

    function render(url) {
      stage.innerHTML = '';
      const lower = url.toLowerCase();
      if (lower.endsWith('.pdf')) {
        const emb = document.createElement('embed');
        emb.type = 'application/pdf';
        emb.src = withCB(url) + '#view=FitH';
        stage.appendChild(emb);
      } else if (lower.endsWith('.jpg') || lower.endsWith('.jpeg') || lower.endsWith('.png') || lower.endsWith('.gif') || lower.endsWith('.webp') || lower.endsWith('.svg')) {
        const img = new Image();
        img.src = withCB(url);
        stage.appendChild(img);
      } else {
        const fr = document.createElement('iframe');
        fr.src = withCB(url);
        stage.appendChild(fr);
      }
    }

    async function init() {
      const { owner, repo } = guessOwnerRepo();
      if (!owner || !repo) return;
      const list = await fetchContents(owner, repo);
      const files = list.filter(x => x.type === 'file' && isSupported(x.name) && !/index\.html/i.test(x.name))
                        .sort((a,b) => a.name.localeCompare(b.name, 'de'))
                        .map(x => x.download_url)
                        .filter(Boolean);
      if (!files.length) return; // bewusst keine Meldung anzeigen

      let i = 0;
      function tick() { render(files[i % files.length]); i++; }
      tick();
      setInterval(tick, INTERVAL_MS);

      // stÃ¼ndliches Neuladen der Dateiliste, ohne Textausgabe
      setInterval(async () => {
        const newList = await fetchContents(owner, repo);
        const newFiles = newList.filter(x => x.type === 'file' && isSupported(x.name) && !/index\.html/i.test(x.name))
                                .sort((a,b) => a.name.localeCompare(b.name, 'de'))
                                .map(x => x.download_url)
                                .filter(Boolean);
        if (newFiles.length) { files.length = 0; newFiles.forEach(u => files.push(u)); i = 0; }
      }, 60*60*1000);
    }
    init();
  </script>
</body>
</html>
